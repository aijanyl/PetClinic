{"ast":null,"code":"var _jsxFileName = \"/Users/aizhanyl/Desktop/PetClinic1/src/components/contexts/ProductContext.js\";\nimport axios from \"axios\";\nimport React, { useContext, useReducer, useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { calcSubPrice, calcTotalPrice } from \"../helpers/calcPrice\";\nimport { API } from \"../helpers/constants\";\nexport const productContext = React.createContext();\nexport const useProduct = () => {\n  return useContext(productContext);\n};\nconst INIT_STATE = {\n  products: [],\n  edit: null,\n  paginatedPages: 1,\n  cart: [],\n  cartLength: 0,\n  detail: [],\n  favorites: []\n};\n\nconst reducer = function () {\n  let state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : INIT_STATE;\n  let action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case \"GET_PRODUCTS\":\n      return { ...state,\n        products: action.payload.data,\n        paginatedPages: Math.ceil(action.payload.headers[\"x-total-count\"] / 3)\n      };\n\n    case \"GET_EDIT_PRODUCT\":\n      return { ...state,\n        edit: action.payload\n      };\n\n    case \"CHANGE_CART_COUNT\":\n      return { ...state,\n        cartLength: action.payload\n      };\n\n    case \"GET_CART\":\n      return { ...state,\n        cart: action.payload\n      };\n\n    case \"GET_DETAIL_PRODUCT\":\n      return { ...state,\n        detail: action.payload\n      };\n\n    case \"CHANGE_FAVORITES_COUNT\":\n      return { ...state,\n        favorites: action.payload\n      };\n\n    default:\n      return state;\n  }\n};\n\nconst ProductsContext = _ref => {\n  let {\n    children\n  } = _ref;\n  const [state, dispatch] = useReducer(reducer, INIT_STATE);\n  const [bar, setBar] = useState(false);\n  const history = useHistory(); // const getProducts = async (history) => {\n  //     const search = new URLSearchParams(history.location.search)\n  //     search.set('_limit', 9)\n  //     history.push(`${history.location.pathname}?${search.toString()}`)\n  //     let data = await axios(`${API}/products/${window.location.search}`)\n  //     dispatch({\n  //         type: \"GET_PRODUCTS\",\n  //         payload: data\n  //     })\n  // }\n\n  const getProducts = async history => {\n    const search = new URLSearchParams(history.location.search);\n    search.set(\"_limit\", 9);\n    history.push(`${history.location.pathname}?${search.toString()}`);\n    const data = await axios(`${API}/products/${window.location.search}`);\n    dispatch({\n      type: \"GET_PRODUCTS\",\n      payload: data\n    });\n  };\n\n  const addProduct = async newProduct => {\n    console.log(newProduct);\n\n    try {\n      let res = await axios.post(`${API}/products`, newProduct);\n      return res;\n    } catch (err) {\n      console.log(err);\n      return err;\n    }\n  };\n\n  const editProduct = async id => {\n    const {\n      data\n    } = await axios.get(`${API}/products/${id}`);\n    dispatch({\n      type: \"GET_EDIT_PRODUCT\",\n      payload: data\n    });\n  };\n\n  const saveEditProduct = async updateProduct => {\n    try {\n      let res = await axios.patch(`${API}/products/${updateProduct.id}`, updateProduct);\n      return res;\n    } catch (error) {\n      console.log(error);\n      return error;\n    }\n  };\n\n  const deleteProduct = async (id, history) => {\n    await axios.delete(`${API}/products/${id}`);\n    getProducts(history);\n  };\n\n  const addProductInCart = product => {\n    let cart = JSON.parse(localStorage.getItem(\"cart\"));\n\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0\n      };\n    }\n\n    let newProduct = {\n      item: product,\n      count: 1,\n      subPrice: 0\n    };\n    let filteredCart = cart.products.filter(elem => elem.item.id === product.id);\n\n    if (filteredCart.length > 0) {\n      cart.products = cart.products.filter(elem => elem.item.id !== product.id);\n    } else {\n      cart.products.push(newProduct);\n    }\n\n    newProduct.subPrice = calcSubPrice(newProduct);\n    cart.totalPrice = calcTotalPrice(cart.products);\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n    dispatch({\n      type: \"CHANGE_CART_COUNT\",\n      payload: cart.products.length\n    });\n  };\n\n  const getCartLength = () => {\n    let cart = JSON.parse(localStorage.getItem(\"cart\"));\n\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0\n      };\n    }\n\n    dispatch({\n      type: \"CHANGE_CART_COUNT\",\n      payload: cart.product.length\n    });\n  };\n\n  const getCart = () => {\n    let cart = JSON.parse(localStorage.getItem(\"cart\"));\n\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0\n      };\n    }\n\n    dispatch({\n      type: \"GET_CART\",\n      payload: cart\n    });\n  };\n\n  const buy = () => {\n    localStorage.clear();\n  };\n\n  const changeProductCount = (count, id) => {\n    let cart = JSON.parse(localStorage.getItem(\"cart\"));\n    cart.products = cart.product.map(elem => {\n      if (elem.item.id === id) {\n        elem.count = count;\n        elem.subPrice = calcSubPrice(elem);\n      }\n\n      return elem;\n    });\n    cart.totalPrice = calcTotalPrice(cart.products);\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n    getCart();\n  };\n\n  const checkProductInCart = id => {\n    let cart = JSON.parse(localStorage.getItem(\"cart\"));\n\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0\n      };\n    }\n\n    let newCart = cart.products.filter(elem => elem.item.id === id);\n    return newCart.length > 0 ? true : false;\n  };\n\n  const getDetail = async id => {\n    const {\n      data\n    } = await axios.get(`${API}/products/${id}`);\n    dispatch({\n      type: \"GET_DETAIL_PRODUCT\",\n      payload: data\n    });\n  };\n\n  const openSidebar = () => {\n    setBar(true);\n  };\n\n  const addProductInFavorites = product => {\n    let favorites = JSON.parse(localStorage.getItem(\"favorites\"));\n\n    if (!favorites) {\n      favorites = {\n        products: []\n      };\n    }\n\n    let newProduct = {\n      item: product\n    };\n    let productToFind = favorites.products.filter(item => item.item.id === product.id);\n\n    if (productToFind.length === 0) {\n      favorites.products.push(newProduct);\n    } else {\n      favorites.products = favorites.products.filter(item => item.item.id !== product.id);\n    }\n\n    localStorage.setItem(\"favorites\", JSON.stringify(favorites));\n    dispatch({\n      type: \"CHANGE_FAVORITES_COUNT\",\n      payload: favorites\n    });\n  };\n\n  const getFavoritesLength = () => {\n    let favorites = JSON.parse(localStorage.getItem(\"favorites\"));\n\n    if (!favorites) {\n      favorites = {\n        products: []\n      };\n    }\n\n    dispatch({\n      type: \"CHANGE_FAVORITES_COUNT\",\n      payload: favorites.product.length\n    });\n  };\n\n  const getFavorites = () => {\n    let favorites = JSON.parse(localStorage.getItem(\"favorites\"));\n\n    if (!favorites) {\n      localStorage.setItem(\"favorites\", JSON.stringify({\n        products: []\n      }));\n      favorites = {\n        products: []\n      };\n    }\n\n    dispatch({\n      type: \"CHANGE_FAVORITES_COUNT\",\n      payload: favorites\n    });\n  };\n\n  const checkProductinFavorites = id => {\n    let favorites = JSON.parse(localStorage.getItem(\"favorites\"));\n\n    if (!favorites) {\n      favorites = {\n        products: []\n      };\n    }\n\n    let newFavorites = favorites.products.filter(elem => elem.item.id === id);\n    return newFavorites.length > 0 ? true : false;\n  };\n\n  return /*#__PURE__*/React.createElement(productContext.Provider, {\n    value: {\n      products: state.products,\n      edit: state.edit,\n      paginatedPages: state.paginatedPages,\n      cart: state.cart,\n      cartLength: state.cartLength,\n      productDetail: state.detail,\n      favorites: state.favorites,\n      getProducts,\n      addProduct,\n      editProduct,\n      saveEditProduct,\n      deleteProduct,\n      addProductInCart,\n      getCartLength,\n      changeProductCount,\n      checkProductInCart,\n      checkProductinFavorites,\n      getCart,\n      getDetail,\n      openSidebar,\n      setBar,\n      bar,\n      buy,\n      getFavorites,\n      addProductInFavorites,\n      getFavoritesLength\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 295,\n      columnNumber: 5\n    }\n  }, children);\n};\n\nexport default ProductsContext;","map":{"version":3,"sources":["/Users/aizhanyl/Desktop/PetClinic1/src/components/contexts/ProductContext.js"],"names":["axios","React","useContext","useReducer","useState","useHistory","calcSubPrice","calcTotalPrice","API","productContext","createContext","useProduct","INIT_STATE","products","edit","paginatedPages","cart","cartLength","detail","favorites","reducer","state","action","type","payload","data","Math","ceil","headers","ProductsContext","children","dispatch","bar","setBar","history","getProducts","search","URLSearchParams","location","set","push","pathname","toString","window","addProduct","newProduct","console","log","res","post","err","editProduct","id","get","saveEditProduct","updateProduct","patch","error","deleteProduct","delete","addProductInCart","product","JSON","parse","localStorage","getItem","totalPrice","item","count","subPrice","filteredCart","filter","elem","length","setItem","stringify","getCartLength","getCart","buy","clear","changeProductCount","map","checkProductInCart","newCart","getDetail","openSidebar","addProductInFavorites","productToFind","getFavoritesLength","getFavorites","checkProductinFavorites","newFavorites","productDetail"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport React, { useContext, useReducer, useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { calcSubPrice, calcTotalPrice } from \"../helpers/calcPrice\";\nimport { API } from \"../helpers/constants\";\n\nexport const productContext = React.createContext();\nexport const useProduct = () => {\n  return useContext(productContext);\n};\nconst INIT_STATE = {\n  products: [],\n  edit: null,\n  paginatedPages: 1,\n  cart: [],\n  cartLength: 0,\n  detail: [],\n  favorites: [],\n};\n\nconst reducer = (state = INIT_STATE, action) => {\n  switch (action.type) {\n    case \"GET_PRODUCTS\":\n      return {\n        ...state,\n        products: action.payload.data,\n        paginatedPages: Math.ceil(action.payload.headers[\"x-total-count\"] / 3),\n      };\n    case \"GET_EDIT_PRODUCT\":\n      return {\n        ...state,\n        edit: action.payload,\n      };\n    case \"CHANGE_CART_COUNT\":\n      return {\n        ...state,\n        cartLength: action.payload,\n      };\n    case \"GET_CART\":\n      return {\n        ...state,\n        cart: action.payload,\n      };\n    case \"GET_DETAIL_PRODUCT\":\n      return {\n        ...state,\n        detail: action.payload,\n      };\n    case \"CHANGE_FAVORITES_COUNT\":\n      return {\n        ...state,\n        favorites: action.payload,\n      };\n    default:\n      return state;\n  }\n};\n\nconst ProductsContext = ({ children }) => {\n  const [state, dispatch] = useReducer(reducer, INIT_STATE);\n  const [bar, setBar] = useState(false);\n  const history = useHistory();\n\n  // const getProducts = async (history) => {\n  //     const search = new URLSearchParams(history.location.search)\n  //     search.set('_limit', 9)\n  //     history.push(`${history.location.pathname}?${search.toString()}`)\n  //     let data = await axios(`${API}/products/${window.location.search}`)\n  //     dispatch({\n  //         type: \"GET_PRODUCTS\",\n  //         payload: data\n  //     })\n  // }\n\n  const getProducts = async (history) => {\n    const search = new URLSearchParams(history.location.search);\n    search.set(\"_limit\", 9);\n    history.push(`${history.location.pathname}?${search.toString()}`);\n    const data = await axios(`${API}/products/${window.location.search}`);\n    dispatch({\n      type: \"GET_PRODUCTS\",\n      payload: data,\n    });\n  };\n  const addProduct = async (newProduct) => {\n    console.log(newProduct);\n    try {\n      let res = await axios.post(`${API}/products`, newProduct);\n      return res;\n    } catch (err) {\n      console.log(err);\n      return err;\n    }\n  };\n\n  const editProduct = async (id) => {\n    const { data } = await axios.get(`${API}/products/${id}`);\n    dispatch({\n      type: \"GET_EDIT_PRODUCT\",\n      payload: data,\n    });\n  };\n\n  const saveEditProduct = async (updateProduct) => {\n    try {\n      let res = await axios.patch(\n        `${API}/products/${updateProduct.id}`,\n        updateProduct\n      );\n      return res;\n    } catch (error) {\n      console.log(error);\n      return error;\n    }\n  };\n\n  const deleteProduct = async (id, history) => {\n    await axios.delete(`${API}/products/${id}`);\n    getProducts(history);\n  };\n\n  const addProductInCart = (product) => {\n    let cart = JSON.parse(localStorage.getItem(\"cart\"));\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0,\n      };\n    }\n    let newProduct = {\n      item: product,\n      count: 1,\n      subPrice: 0,\n    };\n    let filteredCart = cart.products.filter(\n      (elem) => elem.item.id === product.id\n    );\n    if (filteredCart.length > 0) {\n      cart.products = cart.products.filter(\n        (elem) => elem.item.id !== product.id\n      );\n    } else {\n      cart.products.push(newProduct);\n    }\n    newProduct.subPrice = calcSubPrice(newProduct);\n    cart.totalPrice = calcTotalPrice(cart.products);\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n    dispatch({\n      type: \"CHANGE_CART_COUNT\",\n      payload: cart.products.length,\n    });\n  };\n\n  const getCartLength = () => {\n    let cart = JSON.parse(localStorage.getItem(\"cart\"));\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0,\n      };\n    }\n    dispatch({\n      type: \"CHANGE_CART_COUNT\",\n      payload: cart.product.length,\n    });\n  };\n\n  const getCart = () => {\n    let cart = JSON.parse(localStorage.getItem(\"cart\"));\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0,\n      };\n    }\n    dispatch({\n      type: \"GET_CART\",\n      payload: cart,\n    });\n  };\n\n  const buy = () => {\n    localStorage.clear();\n  };\n\n  const changeProductCount = (count, id) => {\n    let cart = JSON.parse(localStorage.getItem(\"cart\"));\n    cart.products = cart.product.map((elem) => {\n      if (elem.item.id === id) {\n        elem.count = count;\n        elem.subPrice = calcSubPrice(elem);\n      }\n      return elem;\n    });\n    cart.totalPrice = calcTotalPrice(cart.products);\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n    getCart();\n  };\n\n  const checkProductInCart = (id) => {\n    let cart = JSON.parse(localStorage.getItem(\"cart\"));\n    if (!cart) {\n      cart = {\n        products: [],\n        totalPrice: 0,\n      };\n    }\n    let newCart = cart.products.filter((elem) => elem.item.id === id);\n    return newCart.length > 0 ? true : false;\n  };\n\n  const getDetail = async (id) => {\n    const { data } = await axios.get(`${API}/products/${id}`);\n    dispatch({\n      type: \"GET_DETAIL_PRODUCT\",\n      payload: data,\n    });\n  };\n\n  const openSidebar = () => {\n    setBar(true);\n  };\n  const addProductInFavorites = (product) => {\n    let favorites = JSON.parse(localStorage.getItem(\"favorites\"));\n    if (!favorites) {\n      favorites = {\n        products: [],\n      };\n    }\n    let newProduct = {\n      item: product,\n    };\n\n    let productToFind = favorites.products.filter(\n      (item) => item.item.id === product.id\n    );\n    if (productToFind.length === 0) {\n      favorites.products.push(newProduct);\n    } else {\n      favorites.products = favorites.products.filter(\n        (item) => item.item.id !== product.id\n      );\n    }\n    localStorage.setItem(\"favorites\", JSON.stringify(favorites));\n    dispatch({\n      type: \"CHANGE_FAVORITES_COUNT\",\n      payload: favorites,\n    });\n  };\n\n  const getFavoritesLength = () => {\n    let favorites = JSON.parse(localStorage.getItem(\"favorites\"));\n    if (!favorites) {\n      favorites = {\n        products: [],\n      };\n    }\n    dispatch({\n      type: \"CHANGE_FAVORITES_COUNT\",\n      payload: favorites.product.length,\n    });\n  };\n\n  const getFavorites = () => {\n    let favorites = JSON.parse(localStorage.getItem(\"favorites\"));\n    if (!favorites) {\n      localStorage.setItem(\n        \"favorites\",\n        JSON.stringify({\n          products: [],\n        })\n      );\n      favorites = {\n        products: [],\n      };\n    }\n    dispatch({\n      type: \"CHANGE_FAVORITES_COUNT\",\n      payload: favorites,\n    });\n  };\n\n  const checkProductinFavorites = (id) => {\n    let favorites = JSON.parse(localStorage.getItem(\"favorites\"));\n    if (!favorites) {\n      favorites = {\n        products: [],\n      };\n    }\n    let newFavorites = favorites.products.filter((elem) => elem.item.id === id);\n    return newFavorites.length > 0 ? true : false;\n  };\n\n  return (\n    <productContext.Provider\n      value={{\n        products: state.products,\n        edit: state.edit,\n        paginatedPages: state.paginatedPages,\n        cart: state.cart,\n        cartLength: state.cartLength,\n        productDetail: state.detail,\n        favorites: state.favorites,\n        getProducts,\n        addProduct,\n        editProduct,\n        saveEditProduct,\n        deleteProduct,\n        addProductInCart,\n        getCartLength,\n        changeProductCount,\n        checkProductInCart,\n        checkProductinFavorites,\n        getCart,\n        getDetail,\n        openSidebar,\n        setBar,\n        bar,\n        buy,\n        getFavorites,\n        addProductInFavorites,\n        getFavoritesLength,\n      }}\n    >\n      {children}\n    </productContext.Provider>\n  );\n};\nexport default ProductsContext;\n"]},"metadata":{},"sourceType":"module"}